---
title: Prometheus从入门到精通（伪）
top: false
cover: false
toc: true
mathjax: true
date: 2020-05-28 14:22:11
photos:
tags: [监控,运维，prometheus]
categories: [运维，prometheus]
---

## 一、Prometheus介绍

###  1.1 为什么要监控

* 及时有效的告知我们：服务发生了事件、服务器出现了故障、环境出现了异常等等
* 出现问题后，利用监控数据追踪溯源，可以更高效的解决问题
* 提高网站/服务的可用性

<!-- more -->

#### 1.1.1 可用性
    在软件系统的高可靠性（也称为可用性，英文描述为HA，High Available）里有个衡量其可靠性的标准——X个9，这个X是代表数字3~5。X个9表示在软件系统1年时间的使用过程中，系统可以正常使用时间与总时间（1年）之比，我们通过下面的计算来感受下X个9在不同级别的可靠性差异。
        1个9：(1-90%)*365=36.5天，表示该软件系统在连续运行1年时间里最多可能的业务中断时间是36.5天
        2个9：(1-99%)*365=3.65天 ， 表示该软件系统在连续运行1年时间里最多可能的业务中断时间是3.65天
        3个9：(1-99.9%)*365*24=8.76小时，表示该软件系统在连续运行1年时间里最多可能的业务中断时间是8.76小时。
        4个9：(1-99.99%)*365*24=0.876小时=52.6分钟，表示该软件系统在连续运行1年时间里最多可能的业务中断时间是52.6分钟。
        5个9：(1-99.999%)*365*24*60=5.26分钟，表示该软件系统在连续运行1年时间里最多可能的业务中断时间是5.26分钟。
        6个9：(1-99.9999%)*365*24*60*60=31秒， 示该软件系统在连续运行1年时间里最多可能的业务中断时间是31秒

### 1.2 监控什么目标
|类型|目标
|----|----|
|硬件监控|服务器IPMI、存储设备、SNMP网络设备、打印机、windows等
|系统监控|CPU、内存、硬盘使用率、硬盘IO、系统负载、进程数等
|服务监控|Mysql、oracle、Redis、Ceph、Hadoop、Apache、Nginx、tomcat、jvm等
|性能监控|网站性能、服务器性能、数据库性能、存储性能
|网络监控|物理端口、Web服务、带宽流量、端口速率、网络使用率、TCP连接数等

### 1.3 开源监控平台/工具
* MRTG 流量监控
* Nagios 综合监控
* Zabbix 综合监控
* Cacti 流量监控
* **Prometheus 综合监控**

### 1.3 Prometheus是什么
Prometheus是一个开放性的监控解决方案

### 1.4 Prometheus如何实现监控

在Prometheus的架构设计中，Prometheus Server并不直接服务监控特定的目标，其主要任务负责数据的收集，存储并且对外提供数据查询支持。因此为了能够监控到某些东西，如主机的CPU使用率，我们需要使用到**Exporter**。Prometheus周期性的从Exporter暴露的HTTP服务地址（通常是/metrics）拉取监控样本数据。

    Exporter可以是一个独立运行的程序独立于监控目标以外，也可以是直接内置在监控目标中。只要能够向Prometheus提供标准格式的监控样本数据即可。

